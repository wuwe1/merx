---
name: 端到端测试
status: open
created: 2026-02-04T08:11:54Z
updated: 2026-02-04T08:11:54Z
github:
depends_on: [002, 003]
parallel: false
conflicts_with: []
---

# Task: 端到端测试

## 描述

创建端到端测试脚本，验证所有渲染功能正常工作，并提交所有更改。

## 验收标准

- [ ] 创建 `scripts/e2e-test.sh` 测试脚本
- [ ] 测试 stdin SVG 渲染
- [ ] 测试 stdin ASCII 渲染
- [ ] 测试文件 SVG 渲染
- [ ] 测试主题颜色应用
- [ ] 测试批量渲染
- [ ] 所有测试通过
- [ ] 代码已提交

## 技术细节

### 测试脚本内容
```bash
#!/bin/bash
# scripts/e2e-test.sh

set -e
echo "=== Merx E2E Tests ==="

# 构建
npm run build

# 测试 1: stdin SVG
echo "Test 1: stdin SVG"
result=$(echo "graph LR; A-->B" | node dist/cli.mjs render)
if [[ $result == *"<svg"* ]]; then
  echo "  ✓ SVG output contains <svg"
else
  echo "  ✗ SVG output missing <svg"
  exit 1
fi

# 测试 2: stdin ASCII
echo "Test 2: stdin ASCII"
result=$(echo "graph LR; A-->B" | node dist/cli.mjs render --ascii)
if [[ $result == *"─"* ]] || [[ $result == *"│"* ]] || [[ $result == *"┌"* ]]; then
  echo "  ✓ ASCII output contains box characters"
else
  echo "  ✗ ASCII output missing box characters"
  exit 1
fi

# 测试 3: 文件渲染
echo "Test 3: file render"
echo "graph TD; Start-->End" > /tmp/test.mmd
node dist/cli.mjs render /tmp/test.mmd -o /tmp/test.svg
if [[ -f /tmp/test.svg ]] && grep -q "<svg" /tmp/test.svg; then
  echo "  ✓ File rendered to SVG"
else
  echo "  ✗ File render failed"
  exit 1
fi

# 测试 4: 主题应用
echo "Test 4: theme colors"
result=$(echo "graph LR; A-->B" | node dist/cli.mjs render --theme tokyo-night)
if [[ $result == *"#1a1b26"* ]] || [[ $result == *"1a1b26"* ]]; then
  echo "  ✓ Theme colors applied"
else
  echo "  ⚠ Theme colors may not be visible in SVG (check manually)"
fi

# 清理
rm -f /tmp/test.mmd /tmp/test.svg

echo ""
echo "=== All tests passed! ==="
```

### 运行方式
```bash
chmod +x scripts/e2e-test.sh
./scripts/e2e-test.sh
```

## 工作量估算

- 规模：S
- 小时数：0.5
- 并行：false

## 完成定义

- [ ] 测试脚本创建
- [ ] 所有测试通过
- [ ] 代码已提交并推送
