---
name: 配置系统
status: open
created: 2026-02-04T02:46:28Z
updated: 2026-02-04T02:51:33Z
github: https://github.com/wuwe1/merx/issues/5
depends_on: [2]
parallel: true
conflicts_with: []
---

# Task: 配置系统

## 描述

实现 .merxrc 配置文件加载和配置合并逻辑，支持项目级和用户级配置。

## 验收标准

- [ ] 自动加载当前目录的 `.merxrc`
- [ ] 自动加载用户主目录的 `~/.merxrc`
- [ ] 配置优先级：CLI flags > ./.merxrc > ~/.merxrc > defaults
- [ ] 无配置文件时使用默认值正常工作
- [ ] 配置文件 JSON 解析错误时显示友好提示

## 技术细节

### 配置接口
```typescript
// src/config.ts
export interface MerxConfig {
  theme: string
  format: 'svg' | 'ascii' | 'png'
  outdir?: string
  ascii: { width: number }
  themes: Record<string, ThemeColors>
}

export const defaultConfig: MerxConfig = {
  theme: 'tokyo-night',
  format: 'svg',
  ascii: { width: 80 }
}
```

### 配置加载
```typescript
export async function loadConfig(cliConfig?: string): Promise<MerxConfig> {
  const configs: Partial<MerxConfig>[] = [defaultConfig]

  // 加载用户级配置
  const homeRc = path.join(os.homedir(), '.merxrc')
  if (await exists(homeRc)) {
    configs.push(await readJson(homeRc))
  }

  // 加载项目级配置
  const projectRc = path.join(process.cwd(), '.merxrc')
  if (await exists(projectRc)) {
    configs.push(await readJson(projectRc))
  }

  // 加载自定义配置路径
  if (cliConfig) {
    configs.push(await readJson(cliConfig))
  }

  return deepMerge(...configs)
}
```

## 依赖

- [ ] 任务 001 完成（项目初始化）
- [ ] 无外部依赖（使用 Node.js 内置 fs）

## 工作量估算

- 规模：S
- 小时数：2-3
- 并行：true（与 002、003 可并行）

## 完成定义

- [ ] 配置加载逻辑实现
- [ ] 配置合并正确
- [ ] 默认值工作
- [ ] 错误处理友好
