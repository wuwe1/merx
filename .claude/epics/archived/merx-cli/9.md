---
name: watch å‘½ä»¤
status: open
created: 2026-02-04T02:46:28Z
updated: 2026-02-04T02:51:33Z
github: https://github.com/wuwe1/merx/issues/9
depends_on: [3, 7]
parallel: true
conflicts_with: []
---

# Task: watch å‘½ä»¤

## æè¿°

å®ç° `merx watch` å‘½ä»¤ï¼Œç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨é‡æ–°æ¸²æŸ“ã€‚

## éªŒæ”¶æ ‡å‡†

- [ ] `merx watch diagram.mmd` ç›‘å¬å•ä¸ªæ–‡ä»¶
- [ ] `merx watch *.mmd` ç›‘å¬å¤šä¸ªæ–‡ä»¶
- [ ] æ–‡ä»¶ä¿®æ”¹åè‡ªåŠ¨é‡æ–°æ¸²æŸ“
- [ ] æ˜¾ç¤ºç›‘å¬çŠ¶æ€å’Œæ¸²æŸ“ç»“æœ
- [ ] Ctrl+C ä¼˜é›…é€€å‡º
- [ ] æ”¯æŒæ‰€æœ‰ render å‘½ä»¤çš„æ ‡å¿—

## æŠ€æœ¯ç»†èŠ‚

### watch å‘½ä»¤å®ç°
```typescript
// src/commands/watch.ts
import { defineCommand } from 'citty'
import { watch } from 'chokidar'

export default defineCommand({
  meta: { name: 'watch', description: 'ç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶é‡æ–°æ¸²æŸ“' },
  args: {
    file: { type: 'positional', description: 'è¾“å…¥æ–‡ä»¶æˆ– glob' },
    output: { type: 'string', alias: 'o' },
    outdir: { type: 'string' },
    theme: { type: 'string' },
    ascii: { type: 'boolean' }
    // ... å…¶ä»– render æ ‡å¿—
  },
  async run({ args }) {
    const files = await resolveInputFiles(args.file)

    console.log(`Watching ${files.length} file(s)...`)
    console.log('Press Ctrl+C to stop.
')

    // åˆå§‹æ¸²æŸ“
    await renderAll(files, args)

    // è®¾ç½®ç›‘å¬
    const watcher = watch(files, {
      persistent: true,
      ignoreInitial: true
    })

    watcher.on('change', async (path) => {
      console.log(`
ğŸ“ Changed: ${path}`)
      try {
        await renderFile(path, args)
        console.log(`âœ… Rendered: ${path}`)
      } catch (error) {
        console.error(`âŒ Error: ${error.message}`)
      }
    })

    // ä¼˜é›…é€€å‡º
    process.on('SIGINT', () => {
      console.log('

Stopping watch...')
      watcher.close()
      process.exit(0)
    })
  }
})
```

### é˜²æŠ–å¤„ç†
```typescript
import { debounce } from './utils/debounce'

const debouncedRender = debounce(async (path: string) => {
  await renderFile(path, args)
}, 100)

watcher.on('change', debouncedRender)
```

## ä¾èµ–

- [ ] ä»»åŠ¡ 002 å®Œæˆï¼ˆrender å‘½ä»¤ï¼‰
- [ ] ä»»åŠ¡ 006 å®Œæˆï¼ˆglob æ”¯æŒï¼‰
- [ ] chokidar ä¾èµ–

## å·¥ä½œé‡ä¼°ç®—

- è§„æ¨¡ï¼šS
- å°æ—¶æ•°ï¼š2-3
- å¹¶è¡Œï¼štrue

## å®Œæˆå®šä¹‰

- [ ] å•æ–‡ä»¶ç›‘å¬å·¥ä½œ
- [ ] glob ç›‘å¬å·¥ä½œ
- [ ] è‡ªåŠ¨é‡æ¸²æŸ“å·¥ä½œ
- [ ] Ctrl+C ä¼˜é›…é€€å‡º
